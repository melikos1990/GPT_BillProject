<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>房租電費自動計算器</title>

  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      line-height: 1.6;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 16px;
    }
    label {
      margin-right: 8px;
    }
    input[type="number"] {
      width: 120px;
      font-size: 16px;
      padding: 8px;
      box-sizing: border-box;
    }
    button {
      margin: 8px 4px 8px 0;
      padding: 12px 12px;
      font-size: 16px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 12px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
      white-space: nowrap;
    }
    th {
      background-color: #f5f5f5;
    }
    .result {
      font-weight: bold;
    }

    .table-responsive {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    /* Mobile friendly - safe version */
    @media (max-width: 600px) {
      body { margin: 10px; }
      h1 { font-size: 20px; }

      button {
        width: 100%;
        margin: 8px 0;
      }

      table { min-width: 700px; }
      th, td { font-size: 14px; }
    }
  </style>
</head>

<body>
  <h1>房租電費自動計算器</h1>
  <p>輸入本期總電費金額後，依序新增每個房間，填入上期與本期電表讀數以及該房間的固定房租與固定雜費，然後點擊「計算」即可自動計算出各房用電度數、電費分攤與總費用。</p>

  <div>
    <label for="totalBill">總電費 (元)：</label>
    <input type="number" id="totalBill" min="0" step="0.01" value="0" />

    <br><br>

    <button type="button" onclick="addRoom()">新增房間</button>
    <button type="button" onclick="calculate()">計算</button>

    <div class="table-responsive">
      <table>
        <thead>
          <tr>
            <th>房間</th>
            <th>上期電表讀數</th>
            <th>本期電表讀數</th>
            <th>用電度數</th>
            <th>固定房租 (元)</th>
            <th>固定雜費 (元)</th>
            <th>電費分攤 (元)</th>
            <th>總費用 (元)</th>
          </tr>
        </thead>
        <tbody id="roomsBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    let roomCount = 0;

    function addRoom() {
      roomCount++;
      const tbody = document.getElementById('roomsBody');
      const tr = document.createElement('tr');

      tr.innerHTML = `
        <td data-label="房間">房間 ${roomCount}</td>
        <td data-label="上期電表讀數"><input type="number" class="prev" min="0" step="0.01" value="0"></td>
        <td data-label="本期電表讀數"><input type="number" class="curr" min="0" step="0.01" value="0"></td>
        <td class="usage" data-label="用電度數">0</td>
        <td data-label="固定房租 (元)"><input type="number" class="rent" min="0" step="0.01" value="0"></td>
        <td data-label="固定雜費 (元)"><input type="number" class="misc" min="0" step="0.01" value="0"></td>
        <td class="share" data-label="電費分攤 (元)">-</td>
        <td class="result" data-label="總費用 (元)">-</td>
      `;
      tbody.appendChild(tr);
    }

    function calculate() {
      const totalBillValue = parseFloat(document.getElementById('totalBill').value) || 0;

      const prevs = Array.from(document.querySelectorAll('.prev')).map(i => parseFloat(i.value) || 0);
      const currents = Array.from(document.querySelectorAll('.curr')).map(i => parseFloat(i.value) || 0);
      const rents = Array.from(document.querySelectorAll('.rent')).map(i => parseFloat(i.value) || 0);
      const miscs = Array.from(document.querySelectorAll('.misc')).map(i => parseFloat(i.value) || 0);

      const usages = currents.map((curr, i) => Math.max(curr - prevs[i], 0));
      const totalUsage = usages.reduce((sum, val) => sum + val, 0);

      const rows = document.querySelectorAll('#roomsBody tr');
      rows.forEach((row, index) => {
        const usage = usages[index];
        const rent = rents[index];
        const misc = miscs[index];

        row.querySelector('.usage').textContent = usage.toFixed(2);

        let share = 0;
        if (totalUsage > 0) share = (usage / totalUsage) * totalBillValue;

        const result = share + rent + misc;

        row.querySelector('.share').textContent = share.toFixed(2) + ' 元';
        row.querySelector('.result').textContent = result.toFixed(2) + ' 元';
      });
    }
  </script>
</body>
</html>
